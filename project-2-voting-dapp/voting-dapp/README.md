# é¡¹ç›®äºŒï¼šVoting dApp

ä½¿ç”¨ create-solana-dappæ„å»ºçš„anchoråº”ç”¨ï¼Œå¹¶ä½¿ç”¨solana-test-validatorå’Œbankrunè¿›è¡Œæœ¬åœ°å¼€å‘å’Œæµ‹è¯•ã€‚Voting dApp æ˜¯ä¸€ä¸ªåŸºäº Solana çš„æŠ•ç¥¨åº”ç”¨ç¨‹åºï¼Œå…è®¸ç”¨æˆ·åˆ›å»ºæŠ•ç¥¨å¹¶è¿›è¡ŒæŠ•ç¥¨ã€‚

---

## ğŸš€ è¿è¡Œæœ¬é¡¹ç›®

```
npm i
anchor build
anchor test
```

---

## ğŸ“š æ•™ç¨‹æ–‡æ¡£
ä¸ä¹‹å‰ä½ æ„å»ºçš„Favoritesåº”ç”¨ç¨‹åºä¸åŒï¼Œæˆ‘ä»¬å°†æœ¬åœ°æ„å»ºè€Œéå…¨éƒ¨åœ¨Solana Playgroundä¸­å®Œæˆã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ­å»ºæœ¬åœ°ç¯å¢ƒæ¥çœŸæ­£åœ°æ„å»ºæˆ‘ä»¬çš„æŠ•ç¥¨åº”ç”¨ã€‚

### **å®‰è£…Rustä¸Solanaå·¥å…·é“¾**

è®¿é—®[Anchoræ–‡æ¡£](https://www.anchor-lang.com/docs/installation)ä¸­çš„å®‰è£…é¡µé¢ï¼Œè¯¥é¡µé¢åˆ—å‡ºäº†æ‰€æœ‰éœ€è¦å®‰è£…çš„ä¸åŒç»„ä»¶ã€‚
1. å®‰è£…Rust
2. å®‰è£…Solana CLI
3. å®‰è£…JavaScriptåŒ…ç®¡ç†å™¨ï¼ˆå¦‚Yarnã€NPMã€Pnpmæˆ–Bunï¼‰
4. å®‰è½¬Anchorç‰ˆæœ¬ç®¡ç†å™¨AVM
5. å®‰è£…Anchor

### **âœ… åˆ›å»ºæŠ•ç¥¨åº”ç”¨ç¨‹åºé¡¹ç›®**

åœ¨å¼€å§‹ç¼–å†™æŠ•ç¥¨æ™ºèƒ½åˆçº¦ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ­å»ºå¥½é¡¹ç›®çš„æ¡†æ¶ã€‚è¿™ä¸€æ­¥éª¤å°†ä½¿ç”¨ `create-solana-dapp` å·¥å…·æ¥ç”Ÿæˆä¸€ä¸ªåŸºç¡€çš„ Solana DApp é¡¹ç›®ã€‚

```bash
npx create-solana-dapp voting-dapp

```
- è¿™æ¡å‘½ä»¤ä¼šå¼•å¯¼ä½ å®Œæˆé¡¹ç›®çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåŸºæœ¬çš„ Solana DApp é¡¹ç›®ç»“æ„ã€‚

### **æ­¥éª¤è¯¦è§£ï¼š**

1. **è¾“å…¥é¡¹ç›®åç§°**ï¼šæˆ‘ä»¬å°†å…¶å‘½åä¸ºÂ `voting-dapp`
2. **é€‰æ‹©å‰ç«¯æ¡†æ¶**ï¼šé€‰æ‹©Â `Next.js`
3. **é€‰æ‹© CSS æ¡†æ¶**ï¼šé€‰æ‹©Â `Tailwind CSS`
4. **æ˜¯å¦æ·»åŠ è®¡æ•°å™¨ç¨‹åº**ï¼šé€‰æ‹©äº†é»˜è®¤é€‰é¡¹ï¼ˆå¯ä»¥ä¿ç•™ï¼‰

æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…æ‰€æœ‰å¿…è¦çš„ä¾èµ–é¡¹ï¼Œå¹¶ä¸ºä½ ç”Ÿæˆä¸€ä¸ªåŸºç¡€çš„é¡¹ç›®ç›®å½•ç»“æ„ã€‚

---

### **ğŸ› ï¸ æ£€æŸ¥å¹¶è¿è¡Œé¡¹ç›®**

ä¸€æ—¦é¡¹ç›®åˆ›å»ºå®Œæˆï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ£€æŸ¥å’Œè¿è¡Œé¡¹ç›®ï¼š

1. **è¿›å…¥é¡¹ç›®ç›®å½•**ï¼š
    
    ```bash
    cd voting-dapp
    
    ```
    
2. **å®‰è£… npm åŒ…**ï¼š
    
    ```bash
    npm install
    
    ```
    
3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**ï¼š
    
    ```bash
    npm run dev
    
    ```

---

### **ğŸ’» è®¾ç½®æœ¬åœ° Solana éªŒè¯èŠ‚ç‚¹**

ä¸ºäº†æµ‹è¯•æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œä¸€ä¸ªæœ¬åœ° Solana éªŒè¯èŠ‚ç‚¹ã€‚è¿™æ ·å¯ä»¥åœ¨ä¸ä¾èµ–å¤–éƒ¨ç½‘ç»œçš„æƒ…å†µä¸‹å¿«é€Ÿè¿­ä»£å’Œè°ƒè¯•ä»£ç ã€‚

**è¿è¡Œ Solana æµ‹è¯•éªŒè¯èŠ‚ç‚¹**ï¼š
    
```bash
solana-test-validator

```
    
è¿™ä¸ªå‘½ä»¤ä¼šåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªæ¨¡æ‹Ÿ Solana ç½‘ç»œçš„éªŒè¯èŠ‚ç‚¹ã€‚
    
  
---

### **ğŸ§ª ç¼–å†™ Poll è´¦æˆ·ç»“æ„**

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå¹¶ä¸”æœ¬åœ°éªŒè¯èŠ‚ç‚¹ä¹Ÿå·²ç»å¯åŠ¨ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹ç¼–å†™æ™ºèƒ½åˆçº¦äº†ã€‚é¦–å…ˆå®šä¹‰ `Poll` è´¦æˆ·ç»“æ„ã€‚

### **å®šä¹‰ Poll ç»“æ„ä½“**

æ‰“å¼€ `programs/src/lib.rs` æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```rust

useanchor_lang::prelude::*;

declare_id!("FqzkXZdwYjurnUKetJCAvaUw5WAqbwzU6gZEwydeEfqS");

#[account]
#[derive(InitSpace)]
pub struct Poll {
    pub poll_id: u64,
    #[max_len(280)]
    pub description:String,
    pub poll_start: i64,
    pub poll_end: i64,
    pub candidates_amount: u64,
}

```

- `poll_id`:æŠ•ç¥¨çš„å”¯ä¸€æ ‡è¯†ç¬¦
- `description`: æŠ•ç¥¨æè¿°ä¿¡æ¯
- `poll_start`: æŠ•ç¥¨å¼€å§‹æ—¶é—´æˆ³
- `poll_end`: æŠ•ç¥¨ç»“æŸæ—¶é—´æˆ³
- `candidates_amount`: é€‰é¡¹æ•°é‡

### **ğŸ› ï¸ å®ç° InitializePoll ä¸Šä¸‹æ–‡ç»“æ„**

åœ¨å®šä¹‰äº† `Poll` è´¦æˆ·ç»“æ„ä¹‹åï¼Œä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ç»“æ„æ¥å¤„ç†åˆå§‹åŒ–æŠ•ç¥¨çš„æ“ä½œã€‚è¿™ä¸€æ­¥éª¤å°†å¸®åŠ©æˆ‘ä»¬ç¡®ä¿åœ¨åˆ›å»ºæ–°æŠ•ç¥¨æ—¶æ‰€æœ‰å¿…è¦çš„è´¦æˆ·å’Œå‚æ•°éƒ½å·²æ­£ç¡®è®¾ç½®ã€‚

### **å®šä¹‰ InitializePoll ä¸Šä¸‹æ–‡ç»“æ„**

æ‰“å¼€ `programs/src/lib.rs` æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```rust

#[derive(Accounts)]
#[instruction(poll_id: u64)]
pub struct InitializePoll<'info> {
    #[account(mut)]
    pub signer: Signer<'info>,

    #[account(
        init,
        payer = signer,
        space = 8 + Poll::INIT_SPACE,
        seeds = [poll_id.to_le_bytes().as_ref()],
        bump
    )]
    pub poll: Account<'info, Poll>,

    pub system_program: Program<'info, System>,
}

```

### **å­—æ®µè¯´æ˜ï¼š**

- `signer`: å‘èµ·äº¤æ˜“çš„é’±åŒ…ç­¾åè€…ï¼ˆç”¨æˆ·ï¼‰
- `poll`: æˆ‘ä»¬è¦åˆå§‹åŒ–çš„æŠ•ç¥¨è´¦æˆ·
    - ä½¿ç”¨ PDAï¼ˆç¨‹åºæ´¾ç”Ÿåœ°å€ï¼‰æœºåˆ¶ï¼Œé€šè¿‡Â `poll_id`Â ä½œä¸ºç§å­ç”Ÿæˆå”¯ä¸€åœ°å€
    - `space = 8 + Poll::INIT_SPACE`Â è¡¨ç¤ºé¢„ç•™ç©ºé—´ï¼Œå…¶ä¸­ 8 æ˜¯è´¦æˆ·å¤´çš„å›ºå®šé•¿åº¦
    - `bump`Â è¡¨ç¤ºè¯¥åœ°å€æ˜¯ PDA å¹¶è‡ªåŠ¨å¤„ç† bump seed
- `system_program`: Solana ç³»ç»Ÿç¨‹åºï¼Œç”¨äºæ”¯ä»˜è´¦æˆ·åˆ›å»ºè´¹ç”¨

---

### **ğŸ’¡ ç¼–å†™ initialize_poll æŒ‡ä»¤**

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸Šä¸‹æ–‡ç»“æ„ï¼Œæ¥ä¸‹æ¥éœ€è¦ç¼–å†™å®é™…çš„æŒ‡ä»¤å‡½æ•°æ¥åˆå§‹åŒ–æŠ•ç¥¨ã€‚

### **ç¼–å†™Â `initialize_poll`Â å‡½æ•°**

åœ¨ `lib.rs` æ–‡ä»¶ä¸­ç»§ç»­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```rust

#[program]
pub mod voting {
use super::*;

    pub fn initialize_poll(ctx: Context<InitializePoll>, poll_id: u64, description:String, poll_start: u64, poll_end: u64) ->Result<()> {
        let poll = &mut ctx.accounts.poll;
        poll.poll_id = poll_id;
        poll.description = description;
        poll.poll_start = poll_start as i64;
        poll.poll_end = poll_end as i64;
        poll.candidates_amount = 0;
        Ok(())
    }
}

```

### **å‚æ•°è¯´æ˜ï¼š**

- `poll_id`: æŠ•ç¥¨çš„å”¯ä¸€æ ‡è¯†ç¬¦
- `description`: æŠ•ç¥¨æè¿°ä¿¡æ¯
- `poll_start`: æŠ•ç¥¨å¼€å§‹æ—¶é—´æˆ³ï¼ˆç§’çº§ï¼‰
- `poll_end`: æŠ•ç¥¨ç»“æŸæ—¶é—´æˆ³ï¼ˆç§’çº§ï¼‰

---

### **ğŸ§ª æµ‹è¯• InitializePoll åŠŸèƒ½**

ä¸ºäº†ç¡®ä¿æˆ‘ä»¬çš„ `initialize_poll` æŒ‡ä»¤èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€äº›æµ‹è¯•ç”¨ä¾‹æ¥è¿›è¡ŒéªŒè¯ã€‚

### **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**

åœ¨ `tests` ç›®å½•ä¸‹çš„ `voting.js` æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š

```jsx

import *as anchorfrom '@coral-xyz/anchor'
import { Program }from '@coral-xyz/anchor'
import { Keypair, PublicKey }from '@solana/web3.js'
import { Voting }from '../target/types/voting'
import { BankrunProvider, startAnchor }from "anchor-bankrun";
import { beforeAll, it, describe, expect }from '@jest/globals'

const IDL = require('../target/idl/voting.json')

const votingAddress =new PublicKey("FqzkXZdwYjurnUKetJCAvaUw5WAqbwzU6gZEwydeEfqS");

describe('Voting', () => {

let context;
let provider;
let votingProgram: anchor.Program<Voting>;

  beforeAll(async () => {
    context =await startAnchor("", [{name: "voting", programId: votingAddress}], []);

    provider =new BankrunProvider(context);

    votingProgram =new Program<Voting>(
      IDL,
      provider,
    );
  })

  it('Initialize Poll',async () => {
await votingProgram.methods.initializePoll(
new anchor.BN(1), // 1000 seconds
      "What is your favorite color?",
new anchor.BN(0), // 0 for no limit
new anchor.BN(1759468874),
    ).rpc();

const [pollAddress] = PublicKey.findProgramAddressSync(
      [new anchor.BN(1).toArrayLike(Buffer, 'le', 8)],
      votingAddress,
    );

const poll =await votingProgram.account.poll.fetch(pollAddress);

    console.log(poll);

    expect(poll.pollId.toNumber()).toEqual(1);
    expect(poll.pollStart.toNumber()).toBeLessThan(poll.pollEnd.toNumber());
  });
});

```
 **è¿è¡Œæµ‹è¯•**ï¼š
    
```bash
anchor test

```
  

### **ğŸ› ï¸ å®šä¹‰ Candidate è´¦æˆ·ç»“æ„**

åœ¨å®Œæˆäº† `Poll` è´¦æˆ·çš„åˆå§‹åŒ–ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®šä¹‰ `Candidate` è´¦æˆ·ç»“æ„ã€‚è¿™ä¸ªè´¦æˆ·å°†å­˜å‚¨æ¯ä¸ªé€‰é¡¹çš„ç›¸å…³ä¿¡æ¯ã€‚

### **å®šä¹‰ Candidate ç»“æ„ä½“**

æ‰“å¼€ `programs/src/lib.rs` æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç æ¥å®šä¹‰ `Candidate` è´¦æˆ·ç»“æ„ï¼š

```rust

#[account]
#[derive(InitSpace)]
pub struct Candidate {
    #[max_len(32)]
    pub candidate_name:String,
    pub candidate_votes: u64,
}

```

### **å­—æ®µè¯´æ˜ï¼š**

- `candidate_name`: é€‰é¡¹çš„åå­—ï¼ˆæœ€å¤š 32 ä¸ªå­—ç¬¦ï¼‰
- `candidate_votes`: é€‰é¡¹è·å¾—çš„ç¥¨æ•°

---

### **ğŸ’¡ å®ç° InitializeCandidate ä¸Šä¸‹æ–‡ç»“æ„**

ç°åœ¨æˆ‘ä»¬æœ‰äº† `Candidate` è´¦æˆ·ç»“æ„ï¼Œä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ç»“æ„æ¥å¤„ç†åˆå§‹åŒ–é€‰é¡¹æ“ä½œã€‚

### **å®šä¹‰ InitializeCandidate ä¸Šä¸‹æ–‡ç»“æ„**

ç»§ç»­åœ¨ `lib.rs` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```rust

#[derive(Accounts)]
#[instruction(candidate_name: String, poll_id: u64)]
pub struct InitializeCandidate<'info> {
    #[account(mut)]
    pub signer: Signer<'info>,

    #[account(
        mut,
        seeds = [poll_id.to_le_bytes().as_ref()],
        bump
    )]
    pub poll: Account<'info, Poll>,

    #[account(
        init,
        payer = signer,
        space = 8 + Candidate::INIT_SPACE,
        seeds = [poll_id.to_le_bytes().as_ref(), candidate_name.as_bytes()],
        bump
    )]
    pub candidate: Account<'info, Candidate>,

    pub system_program: Program<'info, System>,
}

```

npm install solana-bankrun --legacy-peer-deps

### **å­—æ®µè¯´æ˜ï¼š**

- `signer`: å‘èµ·äº¤æ˜“çš„é’±åŒ…ç­¾åè€…ï¼ˆç”¨æˆ·ï¼‰
- `poll`: ç›¸å…³çš„æŠ•ç¥¨è´¦æˆ·ï¼Œç”¨äºæ›´æ–°é€‰é¡¹æ•°é‡
- `candidate`: æˆ‘ä»¬è¦åˆå§‹åŒ–çš„é€‰é¡¹è´¦æˆ·
    - ä½¿ç”¨ PDA åœ°å€æœºåˆ¶ï¼Œé€šè¿‡Â `poll_id`Â å’ŒÂ `candidate_name`Â ä½œä¸ºç§å­ç”Ÿæˆå”¯ä¸€åœ°å€
    - `space = 8 + Candidate::INIT_SPACE`Â è¡¨ç¤ºé¢„ç•™ç©ºé—´ï¼Œå…¶ä¸­ 8 æ˜¯è´¦æˆ·å¤´çš„å›ºå®šé•¿åº¦
    - `bump`Â è¡¨ç¤ºè¯¥åœ°å€æ˜¯ PDA å¹¶è‡ªåŠ¨å¤„ç† bump seed
- `system_program`: Solana ç³»ç»Ÿç¨‹åºï¼Œç”¨äºæ”¯ä»˜è´¦æˆ·åˆ›å»ºè´¹ç”¨

---

### **ğŸ’» ç¼–å†™ initialize_candidate æŒ‡ä»¤**

åœ¨å®šä¹‰äº†ä¸Šä¸‹æ–‡ç»“æ„åï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™å®é™…çš„æŒ‡ä»¤å‡½æ•°æ¥åˆå§‹åŒ–é€‰é¡¹ã€‚

### **ç¼–å†™Â `initialize_candidate`Â å‡½æ•°**

åœ¨ `lib.rs` æ–‡ä»¶ä¸­ç»§ç»­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```rust

pubfninitialize_candidate(ctx: Context<InitializeCandidate>, candidate_name:String, _poll_id: u64) ->Result<()> {
    let candidate = &mut ctx.accounts.candidate;
    let poll = &mut ctx.accounts.poll;
    poll.candidates_amount += 1;

    candidate.candidate_name = candidate_name;
    candidate.candidate_votes = 0;
    Ok(())
}

```

### **å‚æ•°è¯´æ˜ï¼š**

- `candidate_name`: é€‰é¡¹çš„åå­—
- `_poll_id`: æŠ•ç¥¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆè™½ç„¶æœªç›´æ¥ä½¿ç”¨ï¼Œä½†éœ€è¦ä¼ é€’ä»¥ç¡®ä¿æ­£ç¡®ç”Ÿæˆ PDAï¼‰

---

### **ğŸ§ª æµ‹è¯• InitializeCandidate åŠŸèƒ½**

ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„ `initialize_candidate` æŒ‡ä»¤æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€äº›æµ‹è¯•ç”¨ä¾‹æ¥è¿›è¡ŒéªŒè¯ã€‚

### **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**

åœ¨ `tests` ç›®å½•ä¸‹çš„ `voting.js` æ–‡ä»¶ä¸­ï¼Œç»§ç»­æ·»åŠ ä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š

```jsx

it('Initialize Candidate',async () => {
await votingProgram.methods.initializeCandidate(
        "Red",
new anchor.BN(1), // poll_id
    ).rpc();
await votingProgram.methods.initializeCandidate(
        "Blue",
new anchor.BN(1), // poll_id
    ).rpc();

const [blueAddress] = PublicKey.findProgramAddressSync(
        [new anchor.BN(1).toArrayLike(Buffer, 'le', 8), Buffer.from("Blue")],
        votingAddress,
    );

const blueCandidate =await votingProgram.account.candidate.fetch(blueAddress);
    console.log(blueCandidate);

    expect(blueCandidate.candidateVotes.toNumber()).toEqual(0);

const [redAddress] = PublicKey.findProgramAddressSync(
        [new anchor.BN(1).toArrayLike(Buffer, 'le', 8), Buffer.from("Red")],
        votingAddress,
    );

const redCandidate =await votingProgram.account.candidate.fetch(redAddress);
    console.log(redCandidate);
    expect(redCandidate.candidateVotes.toNumber()).toEqual(0);
});

```
    
**è¿è¡Œæµ‹è¯•**ï¼š
    
```bash
anchor test

```

### **ğŸ’¡ å®ç°æŠ•ç¥¨åŠŸèƒ½**

ç°åœ¨æˆ‘ä»¬å·²ç»èƒ½å¤Ÿåˆå§‹åŒ–æŠ•ç¥¨å’Œé€‰é¡¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®ç°å®é™…çš„æŠ•ç¥¨åŠŸèƒ½ã€‚è¿™ä¸€æ­¥éª¤å°†å…è®¸ç”¨æˆ·ä¸ºç‰¹å®šé€‰é¡¹æŠ•ç¥¨ã€‚

### **ç¼–å†™Â `vote`Â æŒ‡ä»¤**

åœ¨ `lib.rs` æ–‡ä»¶ä¸­ç»§ç»­æ·»åŠ ä»¥ä¸‹ä»£ç æ¥å®ç° `vote` å‡½æ•°ï¼š

```rust

pubfnvote(ctx: Context<Vote>, _candidate_name:String, _poll_id: u64) ->Result<()> {
    let candidate = &mut ctx.accounts.candidate;
    // Increment the candidate's votes
    candidate.candidate_votes += 1;
    Ok(())
}

```

### **å‚æ•°è¯´æ˜ï¼š**

- `_candidate_name`: é€‰é¡¹çš„åå­—ï¼ˆè™½ç„¶æœªç›´æ¥ä½¿ç”¨ï¼Œä½†éœ€è¦ä¼ é€’ä»¥ç¡®ä¿æ­£ç¡®ç”Ÿæˆ PDAï¼‰
- `_poll_id`: æŠ•ç¥¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆè™½ç„¶æœªç›´æ¥ä½¿ç”¨ï¼Œä½†éœ€è¦ä¼ é€’ä»¥ç¡®ä¿æ­£ç¡®ç”Ÿæˆ PDAï¼‰

---

### **ğŸ› ï¸ å®šä¹‰ Vote ä¸Šä¸‹æ–‡ç»“æ„**

ä¸ºäº†å¤„ç†æŠ•ç¥¨æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªä¸Šä¸‹æ–‡ç»“æ„ `Vote` æ¥ç¡®ä¿æ‰€æœ‰å¿…è¦çš„è´¦æˆ·å’Œå‚æ•°éƒ½å·²æ­£ç¡®è®¾ç½®ã€‚

### **å®šä¹‰ Vote ä¸Šä¸‹æ–‡ç»“æ„**

ç»§ç»­åœ¨ `lib.rs` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```rust

#[derive(Accounts)]
#[instruction(candidate_name: String, poll_id: u64)]
pub struct Vote<'info> {
    pub signer: Signer<'info>,

    #[account(
        seeds = [poll_id.to_le_bytes().as_ref()],
        bump
    )]
    pub poll: Account<'info, Poll>,

    #[account(
        mut,
        seeds = [poll_id.to_le_bytes().as_ref(), candidate_name.as_bytes()],
        bump
    )]
    pub candidate: Account<'info, Candidate>,
}

```

### **å­—æ®µè¯´æ˜ï¼š**

- `signer`: å‘èµ·äº¤æ˜“çš„é’±åŒ…ç­¾åè€…ï¼ˆç”¨æˆ·ï¼‰
- `poll`: ç›¸å…³çš„æŠ•ç¥¨è´¦æˆ·ï¼Œç”¨äºéªŒè¯æŠ•ç¥¨çš„æœ‰æ•ˆæ€§
- `candidate`: æˆ‘ä»¬è¦ä¸ºå…¶å¢åŠ ç¥¨æ•°çš„é€‰é¡¹è´¦æˆ·
    - ä½¿ç”¨ PDA åœ°å€æœºåˆ¶ï¼Œé€šè¿‡Â `poll_id`Â å’ŒÂ `candidate_name`Â ä½œä¸ºç§å­ç”Ÿæˆå”¯ä¸€åœ°å€
    - `mut`Â è¡¨ç¤ºè¯¥è´¦æˆ·æ˜¯å¯å˜çš„ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨å…¶ä¸­æ›´æ–°ç¥¨æ•°

---

### **ğŸ§ª æµ‹è¯•æŠ•ç¥¨åŠŸèƒ½**

ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„ `vote` æŒ‡ä»¤æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€äº›æµ‹è¯•ç”¨ä¾‹æ¥è¿›è¡ŒéªŒè¯ã€‚

### **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**

åœ¨ `tests` ç›®å½•ä¸‹çš„ `voting.js` æ–‡ä»¶ä¸­ï¼Œç»§ç»­æ·»åŠ ä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š

```jsx

it('Vote',async () => {
await votingProgram.methods
      .vote(
        "Red",
new anchor.BN(1)
      ).rpc();

const [redAddress] = PublicKey.findProgramAddressSync(
        [new anchor.BN(1).toArrayLike(Buffer, 'le', 8), Buffer.from("Red")],
        votingAddress,
    );

const redCandidate =await votingProgram.account.candidate.fetch(redAddress);
    console.log(redCandidate);
    expect(redCandidate.candidateVotes.toNumber()).toEqual(1);
});

```
---


### **æ€»ç»“**

æˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†æŠ•ç¥¨æ™ºèƒ½åˆçº¦çš„æ ¸å¿ƒåŠŸèƒ½å¼€å‘ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å®Œæˆçš„ä¸»è¦æ­¥éª¤å’Œè¦ç‚¹ï¼š

1. **åˆ›å»ºé¡¹ç›®**ï¼š
    - ä½¿ç”¨Â `create-solana-dapp`Â åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Solana DApp é¡¹ç›®ã€‚
    - è®¾ç½®äº†æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œå¹¶ç¡®ä¿æ‰€æœ‰ä¾èµ–é¡¹å·²æ­£ç¡®å®‰è£…ã€‚
2. **å®šä¹‰è´¦æˆ·ç»“æ„**ï¼š
    - å®šä¹‰äº†Â `Poll`Â å’ŒÂ `Candidate`Â è´¦æˆ·ç»“æ„ï¼Œç”¨äºå­˜å‚¨æŠ•ç¥¨ä¿¡æ¯å’Œé€‰é¡¹ä¿¡æ¯ã€‚
    - ä½¿ç”¨ PDAï¼ˆç¨‹åºæ´¾ç”Ÿåœ°å€ï¼‰æœºåˆ¶ç”Ÿæˆå”¯ä¸€åœ°å€ï¼Œä»¥ä¾¿äºæŸ¥æ‰¾å’Œç®¡ç†è¿™äº›è´¦æˆ·ã€‚
3. **å®ç°æŒ‡ä»¤é›†**ï¼š
    - å®ç°äº†ä¸‰ä¸ªä¸»è¦æŒ‡ä»¤ï¼š
        - `initialize_poll`: åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æŠ•ç¥¨ã€‚
        - `initialize_candidate`: åœ¨ç‰¹å®šæŠ•ç¥¨ä¸­æ·»åŠ é€‰é¡¹ã€‚
        - `vote`: å…è®¸ç”¨æˆ·ä¸ºç‰¹å®šé€‰é¡¹æŠ•ç¥¨ï¼Œå¹¶æ›´æ–°å…¶ç¥¨æ•°ã€‚
4. **æµ‹è¯•åŠŸèƒ½**ï¼š
    - ç¼–å†™äº†å•å…ƒæµ‹è¯•æ¥éªŒè¯æ¯ä¸ªæŒ‡ä»¤çš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚
    - åœ¨æœ¬åœ°ç¯å¢ƒä¸­å®Œæˆäº†æ‰€æœ‰æµ‹è¯•ï¼Œä½¿ç”¨çš„æ˜¯ Solana çš„æœ¬åœ°æµ‹è¯•èŠ‚ç‚¹ã€‚